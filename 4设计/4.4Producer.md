# Producer

## 负载均衡

producer将数据直接发送给作为分区leader的broker，整个过程没有任何路由层介入。为了帮助producer完成这个，所有的Kafka节点都可以响应一个关于哪些server是存活的以及一个topic的分区leader的位置的元数据的请求，使得producer将请求发送到合适的server。

客户端控制它将消息发送到哪个分区。这可以通过随机来完成，实现一种随机负载均衡，或者可以通过一些语义分区函数来完成。我们暴露了语义分区接口，通过用户指定一个分区键以及使用这个分区键将消息hash到某一个分区中。例如，如果选择的分区键是一个用户id，则一个特定用户的所有数据会被发送到相同的分区，这使得consumers可以做关于它们消费的本地假设。这种分区方式允许consumers中的本地敏感处理。

## 异步发送

batching机制是实现高效的因素之一，为了实现batching，kafka producer会在内存中累积数据，然后在一个请求中批量发送。batching机制能够配置成累积到一个特定的消息数并且等待某个固定的延迟边界（64k或10ms）。这允许累积更多的字节数发送，以及更少的server端的大I/O操作。缓冲是可配置的，提供了一个机制去trade off少量附加的延迟，换取更好的吞吐。

